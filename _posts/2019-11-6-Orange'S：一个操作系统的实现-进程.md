---
layout:     post
title:      Orange'S：一个操作系统的实现
subtitle:   进程
date:       2019-11-06
header-img: img/post-first-blog-web.jpg
catalog: true
tags:
    - x86
    - 操作系统
    - 进程

---

### 介绍

进程示意图

![](https://raw.githubusercontent.com/dbb4560/StorePicturebed/master/wirtePicture/20191127222551.png)

进程涉及到进程调度！ 书上是说一个进程只干一件事，有很多种进程，也就是CPU 只能运行一个进程，其他进程正在等待！

所以需要一个数据结构记录一个进程的状态，在进程被挂起的时候，进程信息就被写入这个数据结构，等到进程重启的时候，这个信息就重新被读取出来！

实际上进程和进程调度室运行在不同的层级上。

书上举例都是让任务运行在ring1，进程切换运行在ring0.

典型的就是发生时钟中断，时钟中断发生时，中断处理程序会将控制权交给进程调度模块。这时候系统认为应该进行进程切换，进程切换就发生了！当前的进程的状态就被保存起来，队列中的下一个进程将被恢复执行。同一时刻，只能有一个进程处在运行态！（注意，并非每个时钟中断都一定会发生进程切换）。

作者提到是参考minix系统简化的，基本都是拿来主义的！

有兴趣可以直接看minix！

![](https://raw.githubusercontent.com/dbb4560/StorePicturebed/master/wirtePicture/20191127225412.png)

### 最简单的进程

情况是  一个进程运行中，发生了时钟中断，特权级从ring1 到 ring0 ，开始执行时钟中断处理程序，中断处理程序这时调用进程调度模块，指定下一个应该运行的进程，当中断处理程序结束时，下一个进程准备就绪并开始运行，特权级从ring0 跳回ring1

- 进程A 运行
- 时钟中断发生，ring1-> ring0 ，时钟中断处理程序启动。
- 进程调度，下一个应运行的进程（假设进程B）被指定。
- 进程B被恢复，ring0-> ring1 。
- 进程B 运行中！


根据要求，需要实现的功能如下：

- 时钟中断处理程序
- 进程调度模块
- 两个进程

![](https://raw.githubusercontent.com/dbb4560/StorePicturebed/master/wirtePicture/20191127225959.png)


首先要保存CPU 寄存器的值！ 不但有push 也有pushad 一条指令可以保存许多寄存器的值！这些代码放在时钟中断最顶端，以便于中断发生时马上被执行！ 自然恢复时pop ，执行iretd就回到进程B了


### 进程表

PCB 进程表简称，我们会有很多进程

进程表用来描述进程的，必须独立于进程之外的！ 当把寄存器值压到进程表内的时候，已经处在进程管理模块之中了！

当寄存器的值已经被保存到进程表内，进程调度就开始执行了，那么esp指向何处呢？



