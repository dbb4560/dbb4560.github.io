---
layout:     post
title:      Orange'S：一个操作系统的实现
subtitle:   突破512字节限制
date:       2019-11-02
header-img: img/post-first-blog-web.jpg
catalog: true
tags:
    - x86
    - 操作系统
    - 保护模式
    - 突破512字节

---

### 突破512字节

512B是软盘第一扇区的大小，称为引导扇区。

系统要进入保护模式，512B是不够用的。

所以在软盘的其他地方存放一个文件，通过512B的引导扇区，加载到内存，并把控制权交给该它。

一个操作系统从开机到开始运行，大致经历“引导---加载内核入内存--跳入保护模式---开始执行内核”这样一个过程。

也就是说在内核开始执行之前不但要加载内核，还要准备保护模式等一系列工作，如果全部交给引导扇区来做，512B很可能不够用

所以不妨把这个过程交给另外的模块来完成，我们把这个模块叫做Loader。

引导扇区负责把Loader加载入内存并且把控制权交给它。

其他工作放心地交给Loader来做。

整理一下这一章的思路。

目的是突破引导扇区512字节的限制，方法是把在boot里完成loader.bin加载到内存，然后将控制权交给loader.bin(通过跳转)。


**首先是系统引导boot，然后搜寻根目录区找到文件名为loader.bin的条目，在通过其对应的簇号去读取FAT表，把loader.bin文件载入内存（通过中断），loader.bin执行等待。**

不过本章题目虽然是让操作系统走进保护模式，截止到最后还是没有跳入保护模式。

FAT12

FAT12是DOS时代就使用的文件系统，直到现在仍然在软盘上使用。

软盘层次：扇区（sector）磁盘上的最小数据单元 、簇（cluster）一个或多个扇区、分区（Partition）通常指整个文件系统!

**引导扇区是软盘上的第0个扇区，在这个扇区中有一个很重要的数据结构叫做BPB（BIOS Parameter Block） **

以BPB_开头的域属于BPB，以BS_开头的域不属于BPB，只是引导扇区（boot sector）的一部分。


**引导扇区的0--61字节都是BPB_或BS_开头的数据结构**

**引导扇区从62字节开始是引导代码和其他，长度是448字节**



