---
layout:     post
title:      Orange'S：一个操作系统的实现
subtitle:   文件系统
date:       2019-11-09
header-img: img/post-first-blog-web.jpg
catalog: true
tags:
    - x86
    - 操作系统
    - 文件系统

---

### 文件系统


硬盘操作的IO端口


![](https://raw.githubusercontent.com/dbb4560/StorePicturebed/master/wirtePicture/20191204143915.png)

硬盘驱动程序

要先创建硬盘，按照书上所提供的方法，使用bximage创建！

![](https://raw.githubusercontent.com/dbb4560/StorePicturebed/master/wirtePicture/20191204164909.png)

做好了80MB的硬盘，512字节的扇区！

给出了bochsrc配置信息的提示：

The following line should appear in your bochsrc:
  ata0-master: type=disk, path="80m.img", mode=flat

修改bochsrc

注意书上的源代码是这样的：

```
ata0: enabled=1, ioaddr1=0x1f0, ioaddr2=0x3f0, irq=14
# !! Remember to change these if the hd img is changed:
#    1. include/sys/config.h::MINOR_BOOT
#    2. boot/include/load.inc::ROOT_BASE
#    3. Makefile::HD
#    4. commands/Makefile::HD
ata0-master: type=disk, path="80m.img", mode=flat, cylinders=162, heads=16, spt=63

```

经实践，不需要 `cylinders=162, heads=16, spt=63` 这些信息！

chapter9 a节的代码

![](https://raw.githubusercontent.com/dbb4560/StorePicturebed/master/wirtePicture/20191204165254.png)